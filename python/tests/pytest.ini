[pytest]
# ============================================================================
# CONFIGURACIÓN BÁSICA
# ============================================================================

# Directorio(s) donde buscar tests
testpaths = .

# Patrón de archivos de test
python_files = test_*.py

# Patrón de clases de test
python_classes = Test*

# Patrón de funciones de test
python_functions = test_*

# ============================================================================
# OPCIONES POR DEFECTO
# ============================================================================

addopts = 
    # Verbosidad
    -v
    --strict-markers
    --strict-config
    
    # Formato de traceback
    --tb=short
    
    # Mostrar resumen de todos los tipos de tests
    -ra
    
    # No capturar warnings por defecto (mostrarlos)
    --disable-warnings
    
    # Mostrar el porcentaje de progreso
    --color=yes
    
    # Mostrar los N tests más lentos
    --durations=10
    
    # Salir en el primer fallo (comentar para ver todos los fallos)
    # -x
    
    # Mostrar variables locales en traceback
    # -l
    
    # Ejecutar tests en paralelo (requiere pytest-xdist)
    # -n auto

# ============================================================================
# MARKERS PERSONALIZADOS
# ============================================================================

markers =
    smoke: Tests de humo - verificación rápida de funcionalidad básica
    ui: Tests de interfaz de usuario con Selenium
    integration: Tests de integración de múltiples componentes
    slow: Tests que toman más de 10 segundos en ejecutarse
    api: Tests de API/endpoints
    unit: Tests unitarios
    regression: Tests de regresión para bugs conocidos
    wip: Work in progress - tests en desarrollo
    skip_ci: Tests que se saltan en CI/CD

# ============================================================================
# TIMEOUTS
# ============================================================================

# Timeout global para todos los tests (requiere pytest-timeout)
timeout = 300
timeout_method = thread

# ============================================================================
# LOGGING
# ============================================================================

# Nivel de log durante la ejecución
log_cli = true
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)8s] %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S

# Archivo de log
log_file = tests.log
log_file_level = DEBUG
log_file_format = %(asctime)s [%(levelname)8s] [%(filename)s:%(lineno)d] %(message)s
log_file_date_format = %Y-%m-%d %H:%M:%S

# ============================================================================
# WARNINGS
# ============================================================================

# Filtros de warnings
filterwarnings =
    # Ignorar warnings específicos de bibliotecas
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    
    # Convertir ciertos warnings en errores
    # error::UserWarning
    
    # Ignorar warnings específicos de selenium
    ignore:.*unclosed.*:ResourceWarning
    ignore:.*Selenium.*:DeprecationWarning

# ============================================================================
# COVERAGE (requiere pytest-cov)
# ============================================================================

# Configuración de coverage
# Descomentar para habilitar
# --cov=app
# --cov-report=html
# --cov-report=term-missing
# --cov-fail-under=80

# ============================================================================
# PLUGINS
# ============================================================================

# pytest-html: Reportes HTML
# Descomentar para habilitar
# --html=test_reports/report.html
# --self-contained-html

# pytest-json-report: Reportes JSON
# Descomentar para habilitar
# --json-report
# --json-report-file=test_reports/report.json

# pytest-sugar: Mejor visualización de progreso
# Se activa automáticamente si está instalado

# ============================================================================
# CONFIGURACIÓN DE SELENIUM
# ============================================================================

# Variables de entorno que pueden sobrescribirse
# TEST_BASE_URL = http://127.0.0.1:5000/
# HEADLESS = true
# WINDOW_WIDTH = 1920
# WINDOW_HEIGHT = 1080
# MAX_COMBAT_TURNS = 50

# ============================================================================
# COLECCIÓN DE TESTS
# ============================================================================

# Ignorar ciertos directorios durante la colección
norecursedirs = 
    .git
    .tox
    dist
    build
    *.egg
    __pycache__
    venv
    env
    node_modules
    .venv

# ============================================================================
# CACHE
# ============================================================================

# Configuración de cache de pytest
cache_dir = .pytest_cache

# ============================================================================
# XDIST (Ejecución paralela - requiere pytest-xdist)
# ============================================================================

# Número de workers para ejecución paralela
# Descomentar para usar
# -n auto  # Usa todos los cores disponibles
# -n 4     # Usa 4 workers

# Estrategia de distribución
# --dist loadscope  # Distribuye por scope (más rápido para tests con fixtures costosas)
# --dist loadfile   # Distribuye por archivo

# ============================================================================
# RERUN (Re-ejecución de fallos - requiere pytest-rerunfailures)
# ============================================================================

# Re-ejecutar tests que fallen
# Descomentar para habilitar
# --reruns 2
# --reruns-delay 1

# ============================================================================
# INSTAFAIL (Mostrar fallos inmediatamente - requiere pytest-instafail)
# ============================================================================

# Mostrar fallos inmediatamente en lugar de al final
# Descomentar para habilitar
# --instafail

# ============================================================================
# CONSOLE OUTPUT
# ============================================================================

# Configuración de output en consola
console_output_style = progress

# Mostrar solo el primer fallo en cada test
# --maxfail=1

# ============================================================================
# ORDEN DE EJECUCIÓN
# ============================================================================

# Ejecutar primero los tests que fallaron la última vez
# Descomentar para habilitar
# --failed-first
# --ff

# Ejecutar solo los tests que fallaron la última vez
# --last-failed
# --lf

# ============================================================================
# MINIMUM VERSION
# ============================================================================

# Versión mínima de pytest requerida
minversion = 7.0

# ============================================================================
# DOCTEST
# ============================================================================

# Ejecutar doctests en módulos
# Descomentar para habilitar
# --doctest-modules

# ============================================================================
# REGISTRO DE ASSERTS
# ============================================================================

# Habilitar registro detallado de asserts
enable_assertion_pass_hook = false

# ============================================================================
# PYTHON PATH
# ============================================================================

# Agregar directorios al PYTHONPATH
pythonpath = .

# ============================================================================
# CUSTOM OPTIONS
# ============================================================================

# Aquí puedes agregar opciones personalizadas para tus tests
# Ejemplo:
# --browser=chrome
# --slow-test-threshold=10
